(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(e){if(e.ep)return;e.ep=!0;const i=o(e);fetch(e.href,i)}})();var t,b;let k="",w=!0,f,m=null,L;const T={top:5,bottom:window.innerHeight*.5},$={top:100,bottom:100,left:300,right:50};async function j(){const n=E(t.getStyle().layers),o=document.getElementById("serveiSelector2").value;let a=null;if(t.getLayer("clicked-layer")){const i=t.getSource("clicked-layer");i&&i._data&&(a=i._data)}let e;o==="orto"?e="https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json":o==="topo"?e="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json":o==="fosc"&&(e="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json"),t.setStyle(e),t.once("styledata",()=>{a&&(t.getSource("clicked-layer")||t.addSource("clicked-layer",{type:"geojson",data:a}),t.getLayer("clicked-layer")||t.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#f9f91d","fill-outline-color":"#f9f91d","fill-opacity":.5}},n)),P().then(function(){I()})})}async function P(){t.getSource("terrainMapZen")||t.addSource("terrainMapZen",{type:"raster-dem",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",tileSize:512,maxzoom:14})}function I(){try{t.setTerrain({source:"terrainMapZen",exaggeration:1.5})}catch(n){console.log("ERROR addTerrain"),console.log(n)}}function C(){t.getLayer("clicked-layer")&&t.removeLayer("clicked-layer"),t.getSource("clicked-layer")&&t.removeSource("clicked-layer")}function A(n){const r=E(t.getStyle().layers);t.getLayer("hovered-layer")&&t.removeLayer("hovered-layer"),t.getSource("hovered-layer")&&t.removeSource("hovered-layer");let o=new maplibregl.LngLatBounds;for(let a=0;a<f.length;a++)if(n===f[a].id){t.addSource("hovered-layer",{type:"geojson",data:{type:"Feature",geometry:f[a].geometry,properties:{}}}),t.addLayer({id:"hovered-layer",type:"fill",source:"hovered-layer",layout:{},paint:{"fill-color":"white","fill-opacity":.4}},r);const e=f[a].geometry;e.type==="Polygon"?e.coordinates[0].forEach(i=>{o.extend(i)}):e.type==="MultiPolygon"&&e.coordinates.forEach(i=>{i[0].forEach(s=>{o.extend(s)})})}}function N(){t.getLayer("hovered-layer")&&t.removeLayer("hovered-layer"),t.getSource("hovered-layer")&&t.removeSource("hovered-layer")}async function x(n,r,o){_(),M(),H();for(let c=0;c<L.length;c++){const{id:d,checked:p}=L[c];p===!0?(o!==""&&(o+=","),o+=d):w=!1}o+=",geocoder,elevacions",w&&(o="all");const e=await(await fetch(`https://api.icgc.cat/territori/${o}/geo/${r}/${n}`)).json();f=e.responses.features;const i=document.getElementById("infoPanelContent");i.innerHTML="";let s=[],l=null,u=null;if(e.numResponses<2)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let c=0;c<e.responses.features.length;c++)s.push(e.responses.features[c].id),e.responses.features[c].id==="Geocodificador"?l=e.responses.features[c].properties:e.responses.features[c].id==="Elevació"&&(u=e.responses.features[c].properties.value);l&&(i.innerHTML+=`<b>Adreça: </b> ${l.etiqueta} <br>`),u&&(i.innerHTML+=`<b>Coordenades: </b> ${n.toFixed(4)}, ${r.toFixed(4)} <br>`,i.innerHTML+=`<b>Elevació: </b> ${u} metres<br><br>`);for(let c=0;c<s.length;c++)if(s[c]!=="Geocodificador"&&s[c]!=="Elevació"&&s[c]!=="H3 geospatial indexing system"){const d=s[c],p=document.createElement("button");p.textContent=d,p.classList.add("myButtonClass"),p.addEventListener("click",()=>{m=d,h(d,p)}),p.addEventListener("mouseover",()=>{A(d)}),p.addEventListener("mouseout",()=>{N()}),i.appendChild(p),i.appendChild(document.createElement("br"))}s.length>0&&!m?setTimeout(()=>{m=s[0],h(m,i.querySelector(".myButtonClass"))},25):m&&document.querySelectorAll(".myButtonClass").forEach(d=>{d.textContent.includes(m)&&h(m,d)})}q()}function h(n,r){const o=E(t.getStyle().layers);C();const a=document.querySelector(".closeButtonClass");a&&a.parentNode.removeChild(a);let e=new maplibregl.LngLatBounds;for(let l=0;l<f.length;l++)if(n===f[l].id){t.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:f[l].geometry,properties:{}}}),t.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#f9f91d","fill-outline-color":"#f9f91d","fill-opacity":.5}},o);const u=f[l].geometry;u.type==="Polygon"?u.coordinates[0].forEach(y=>{e.extend(y)}):u.type==="MultiPolygon"&&u.coordinates.forEach(y=>{y[0].forEach(v=>{e.extend(v)})}),document.querySelectorAll(".layer-properties").forEach(y=>y.remove());const d=document.createElement("div");d.classList.add("layer-properties");const p=f[l].properties;for(const[y,v]of Object.entries(p)){const S=document.createElement("div");S.textContent=`${y}: ${v}`,d.appendChild(S)}const g=document.createElement("button");g.textContent="×",g.classList.add("closeButtonClass"),g.addEventListener("click",()=>{C(),d.remove(),g.remove(),r.classList.remove("highlighted-button")}),d.appendChild(g),r.parentNode.insertBefore(d,r.nextSibling),r.parentNode.insertBefore(g,r.nextSibling),document.querySelectorAll(".myButtonClass").forEach(y=>y.classList.remove("highlighted-button")),r.classList.add("highlighted-button")}const s=window.innerWidth<750?T:$;t.fitBounds(e,{padding:s})}function O(){t=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",center:[2.0042,41.7747],zoom:7,maxZoom:18,attributionControl:!1,hash:!1}),t.on("load",function(){P().then(function(){I()}),t.addControl(new maplibregl.NavigationControl,"top-right");var n=new maplibregl.FullscreenControl;t.addControl(n,"top-right"),t.addControl(new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1}),"top-right"),t.addControl(new D,"top-right"),t.on("click",function(r){var o=document.getElementById("notification");o&&o.classList.remove("show");let a=r.lngLat.lng,e=r.lngLat.lat;m?(C(),x(e,a,k).then(()=>{h(m,document.querySelector(".myButtonClass.highlighted-button"))})):x(e,a,k),b?b.setLngLat([a,e]):b=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([a,e]).addTo(t)})})}function E(n){let r="background";for(var o=0;o<n.length;o++)if(n[o].type=="symbol"&&n[o]["source-layer"]!=="contour")return r=n[o].id,r}async function F(n){const o=await(await fetch(`https://api.icgc.cat/territori/adress/${n}`)).json();o.features?(t.getLayer("punts2")?(t.removeLayer("punts2").removeSource("punts2"),t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:o.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})):(t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:o.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})),t.flyTo({center:[o.features[0].geometry.coordinates[0],o.features[0].geometry.coordinates[1]],zoom:11,essential:!0})):alert(o);const a=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});t.getLayer("punts2")&&(t.on("mouseenter","punts2",function(e){t.getCanvas().style.cursor="pointer",a.setLngLat(e.features[0].geometry.coordinates).setHTML(`Adreça: <b>${e.features[0].properties.etiqueta}</b><br>
      Carrer: <b>${e.features[0].properties.nom}</b><br>
      Municipi: <b>${e.features[0].properties.municipi}</b><br>
      Codi Postal: <b>${e.features[0].properties.codi_postal}</b><br>`).addTo(t)}),t.on("mouseleave","punts2",function(e){t.getCanvas().style.cursor="",a.remove()}))}function H(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function q(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}class D{onAdd(r){return this._map=r,this._container=document.createElement("button"),this._container.className="maplibregl-ctrl pitch-control",this._container.textContent="3D",this._container.onclick=()=>{this._map.getPitch()===0?(this._map.easeTo({pitch:60}),this._container.textContent="2D"):(this._map.easeTo({pitch:0}),this._container.textContent="3D")},this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function G(){var n=document.getElementById("notification");n&&n.classList.remove("show");var r=document.getElementById("myModal"),o=document.getElementById("configListContainer");r.style.display="block",fetch("https://api.icgc.cat/territori/info").then(e=>e.json()).then(e=>{o.innerHTML="",e.forEach(i=>{if(i.nomAPI!=="geocoder"&&i.nomAPI!=="elevacions"){const s=document.createElement("div");s.className="config-item";const l=document.createElement("input");l.type="checkbox",l.id=`${i.nomAPI}`,l.name=i.name,l.checked=!0;const u=document.createElement("label");u.htmlFor=`checkbox-${i.nomAPI}`,u.textContent=i.text,s.appendChild(l),s.appendChild(u),o.appendChild(s)}}),_()}).catch(e=>console.error("Error fetching data:",e));var a=document.getElementsByClassName("close")[0];a.onclick=function(){B(),r.style.display="none"},window.onclick=function(e){e.target==r&&(B(),r.style.display="none")}}function B(){const n=document.querySelectorAll('.config-item input[type="checkbox"]'),r=Array.from(n).map(o=>({id:o.id,checked:o.checked}));localStorage.setItem("layerConfig",JSON.stringify(r))}function _(){const n=JSON.parse(localStorage.getItem("layerConfig"));n&&(L=n,n.forEach(r=>{const o=document.getElementById(r.id);o&&(o.checked=r.checked)}))}function M(){var n=document.getElementById("infoPanel");n.classList.add("open"),n.style.width="300px",document.getElementById("openPanel").style.display="none"}function W(){var n=document.getElementById("infoPanel");n.classList.remove("open"),n.style.width="0px",document.getElementById("openPanel").style.display="block"}function z(){O();const n=document.getElementById("textSelector");n.addEventListener("change",()=>{const o=n.value;F(o)}),document.getElementById("layerConfig").addEventListener("click",()=>{G()})}window.addEventListener("DOMContentLoaded",z);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(n=>{console.log("Service Worker registered with scope:",n.scope)},n=>{console.log("Service Worker registration failed:",n)})});window.closePanel=W;window.openPanel=M;window.onBaseChange=j;
