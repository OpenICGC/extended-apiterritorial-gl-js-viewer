(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();var t,b;let k="",w=!0,f,m=null,L;const T={top:5,bottom:window.innerHeight*.5},$={top:100,bottom:100,left:300,right:50};async function j(){const n=E(t.getStyle().layers),o=document.getElementById("serveiSelector2").value;let a=null;if(t.getLayer("clicked-layer")){const r=t.getSource("clicked-layer");r&&r._data&&(a=r._data)}let e;o==="orto"?e="https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json":o==="topo"?e="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json":o==="fosc"&&(e="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json"),t.setStyle(e),t.once("styledata",()=>{a&&(t.getSource("clicked-layer")||t.addSource("clicked-layer",{type:"geojson",data:a}),t.getLayer("clicked-layer")||t.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#f9f91d","fill-outline-color":"#f9f91d","fill-opacity":.5}},n)),P().then(function(){I()})})}async function P(){t.getSource("terrainMapZen")||t.addSource("terrainMapZen",{type:"raster-dem",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",tileSize:512,maxzoom:14})}function I(){try{t.setTerrain({source:"terrainMapZen",exaggeration:1.5})}catch(n){console.log("ERROR addTerrain"),console.log(n)}}function C(){t.getLayer("clicked-layer")&&t.removeLayer("clicked-layer"),t.getSource("clicked-layer")&&t.removeSource("clicked-layer")}function A(n){const i=E(t.getStyle().layers);t.getLayer("hovered-layer")&&t.removeLayer("hovered-layer"),t.getSource("hovered-layer")&&t.removeSource("hovered-layer");let o=new maplibregl.LngLatBounds;for(let a=0;a<f.length;a++)if(n===f[a].id){t.addSource("hovered-layer",{type:"geojson",data:{type:"Feature",geometry:f[a].geometry,properties:{}}}),t.addLayer({id:"hovered-layer",type:"fill",source:"hovered-layer",layout:{},paint:{"fill-color":"white","fill-opacity":.4}},i);const e=f[a].geometry;e.type==="Polygon"?e.coordinates[0].forEach(r=>{o.extend(r)}):e.type==="MultiPolygon"&&e.coordinates.forEach(r=>{r[0].forEach(c=>{o.extend(c)})})}}function N(){t.getLayer("hovered-layer")&&t.removeLayer("hovered-layer"),t.getSource("hovered-layer")&&t.removeSource("hovered-layer")}async function x(n,i,o){_(),M(),H();for(let l=0;l<L.length;l++){const{id:d,checked:p}=L[l];p===!0?(o!==""&&(o+=","),o+=d):w=!1}o+=",geocoder,elevacions",w&&(o="all");const e=await(await fetch(`https://api.icgc.cat/territori/${o}/geo/${i}/${n}`)).json();f=e.responses.features;const r=document.getElementById("infoPanelContent");r.innerHTML="";let c=[],s=null,u=null;if(e.numResponses<2)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let l=0;l<e.responses.features.length;l++)c.push(e.responses.features[l].id),e.responses.features[l].id==="Geocodificador"?s=e.responses.features[l].properties:e.responses.features[l].id==="Elevació"&&(u=e.responses.features[l].properties.value);s&&(r.innerHTML+=`<b>Adreça: </b> ${s.etiqueta} <br>`),u&&(r.innerHTML+=`<b>Coordenades: </b> ${n.toFixed(4)}, ${i.toFixed(4)} <br>`,r.innerHTML+=`<b>Elevació: </b> ${u} metres<br><br>`);for(let l=0;l<c.length;l++)if(c[l]!=="Geocodificador"&&c[l]!=="Elevació"&&c[l]!=="H3 geospatial indexing system"){const d=c[l],p=document.createElement("button");p.textContent=d,p.classList.add("myButtonClass"),p.addEventListener("click",()=>{m=d,h(d,p)}),p.addEventListener("mouseover",()=>{A(d)}),p.addEventListener("mouseout",()=>{N()}),r.appendChild(p),r.appendChild(document.createElement("br"))}c.length>0&&!m?setTimeout(()=>{m=c[0],h(m,r.querySelector(".myButtonClass"))},25):m&&document.querySelectorAll(".myButtonClass").forEach(d=>{d.textContent.includes(m)&&h(m,d)})}q()}function h(n,i){const o=E(t.getStyle().layers);C();const a=document.querySelector(".closeButtonClass");a&&a.parentNode.removeChild(a);let e=new maplibregl.LngLatBounds;for(let s=0;s<f.length;s++)if(n===f[s].id){t.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:f[s].geometry,properties:{}}}),t.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#f9f91d","fill-outline-color":"#f9f91d","fill-opacity":.5}},o);const u=f[s].geometry;u.type==="Polygon"?u.coordinates[0].forEach(y=>{e.extend(y)}):u.type==="MultiPolygon"&&u.coordinates.forEach(y=>{y[0].forEach(v=>{e.extend(v)})}),document.querySelectorAll(".layer-properties").forEach(y=>y.remove());const d=document.createElement("div");d.classList.add("layer-properties");const p=f[s].properties;for(const[y,v]of Object.entries(p)){const S=document.createElement("div");S.textContent=`${y}: ${v}`,d.appendChild(S)}const g=document.createElement("button");g.textContent="×",g.classList.add("closeButtonClass"),g.addEventListener("click",()=>{C(),d.remove(),g.remove(),i.classList.remove("highlighted-button")}),d.appendChild(g),i.parentNode.insertBefore(d,i.nextSibling),i.parentNode.insertBefore(g,i.nextSibling),document.querySelectorAll(".myButtonClass").forEach(y=>y.classList.remove("highlighted-button")),i.classList.add("highlighted-button")}const c=window.innerWidth<750?T:$;t.fitBounds(e,{padding:c})}function O(){t=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",center:[2.0042,41.7747],zoom:7,maxZoom:18,attributionControl:!1,hash:!1}),t.on("load",function(){P().then(function(){I()}),t.addControl(new maplibregl.NavigationControl,"top-right");var n=new maplibregl.FullscreenControl;t.addControl(n,"top-right");const i=new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1});i.on("geolocate",function(o){const a=o.coords.longitude,e=o.coords.latitude,r={lngLat:{lng:a,lat:e}};t.fire("click",r)}),t.addControl(i,"top-right"),t.addControl(new D,"top-right"),t.on("click",function(o){var a=document.getElementById("notification");a&&a.classList.remove("show");let e=o.lngLat.lng,r=o.lngLat.lat;m?(C(),x(r,e,k).then(()=>{h(m,document.querySelector(".myButtonClass.highlighted-button"))})):x(r,e,k),b?b.setLngLat([e,r]):b=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([e,r]).addTo(t)})})}function E(n){let i="background";for(var o=0;o<n.length;o++)if(n[o].type=="symbol"&&n[o]["source-layer"]!=="contour")return i=n[o].id,i}async function F(n){const o=await(await fetch(`https://api.icgc.cat/territori/adress/${n}`)).json();o.features?(t.getLayer("punts2")?(t.removeLayer("punts2").removeSource("punts2"),t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:o.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})):(t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:o.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})),t.flyTo({center:[o.features[0].geometry.coordinates[0],o.features[0].geometry.coordinates[1]],zoom:11,essential:!0})):alert(o);const a=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});t.getLayer("punts2")&&(t.on("mouseenter","punts2",function(e){t.getCanvas().style.cursor="pointer",a.setLngLat(e.features[0].geometry.coordinates).setHTML(`Adreça: <b>${e.features[0].properties.etiqueta}</b><br>
      Carrer: <b>${e.features[0].properties.nom}</b><br>
      Municipi: <b>${e.features[0].properties.municipi}</b><br>
      Codi Postal: <b>${e.features[0].properties.codi_postal}</b><br>`).addTo(t)}),t.on("mouseleave","punts2",function(e){t.getCanvas().style.cursor="",a.remove()}))}function H(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function q(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}class D{onAdd(i){return this._map=i,this._container=document.createElement("button"),this._container.className="maplibregl-ctrl pitch-control",this._container.textContent="3D",this._container.onclick=()=>{this._map.getPitch()===0?(this._map.easeTo({pitch:60}),this._container.textContent="2D"):(this._map.easeTo({pitch:0}),this._container.textContent="3D")},this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function G(){var n=document.getElementById("notification");n&&n.classList.remove("show");var i=document.getElementById("myModal"),o=document.getElementById("configListContainer");i.style.display="block",fetch("https://api.icgc.cat/territori/info").then(e=>e.json()).then(e=>{o.innerHTML="",e.forEach(r=>{if(r.nomAPI!=="geocoder"&&r.nomAPI!=="elevacions"){const c=document.createElement("div");c.className="config-item";const s=document.createElement("input");s.type="checkbox",s.id=`${r.nomAPI}`,s.name=r.name,s.checked=!0;const u=document.createElement("label");u.htmlFor=`checkbox-${r.nomAPI}`,u.textContent=r.text,c.appendChild(s),c.appendChild(u),o.appendChild(c)}}),_()}).catch(e=>console.error("Error fetching data:",e));var a=document.getElementsByClassName("close")[0];a.onclick=function(){B(),i.style.display="none"},window.onclick=function(e){e.target==i&&(B(),i.style.display="none")}}function B(){const n=document.querySelectorAll('.config-item input[type="checkbox"]'),i=Array.from(n).map(o=>({id:o.id,checked:o.checked}));localStorage.setItem("layerConfig",JSON.stringify(i))}function _(){const n=JSON.parse(localStorage.getItem("layerConfig"));n&&(L=n,n.forEach(i=>{const o=document.getElementById(i.id);o&&(o.checked=i.checked)}))}function M(){var n=document.getElementById("infoPanel");n.classList.add("open"),n.style.width="300px",document.getElementById("openPanel").style.display="none"}function W(){var n=document.getElementById("infoPanel");n.classList.remove("open"),n.style.width="0px",document.getElementById("openPanel").style.display="block"}function z(){O();const n=document.getElementById("textSelector");n.addEventListener("change",()=>{const o=n.value;F(o)}),document.getElementById("layerConfig").addEventListener("click",()=>{G()})}window.addEventListener("DOMContentLoaded",z);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/serviceworker.js").then(n=>{console.log("Service Worker registered with scope:",n.scope)},n=>{console.log("Service Worker registration failed:",n)})});window.closePanel=W;window.openPanel=M;window.onBaseChange=j;
