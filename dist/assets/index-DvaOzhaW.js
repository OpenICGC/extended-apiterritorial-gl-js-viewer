(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=o(t);fetch(t.href,n)}})();var e,g;let C="all",m;const E={top:5,bottom:window.innerHeight*.5},S=150;async function k(){const r=b(e.getStyle().layers),o=document.getElementById("serveiSelector2").value;let a=null;if(e.getLayer("clicked-layer")){const n=e.getSource("clicked-layer");n&&n._data&&(a=n._data)}let t;o==="orto"?t="https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json":o==="topo"?t="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json":o==="fosc"&&(t="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json"),e.setStyle(t),e.once("styledata",()=>{a&&(e.getSource("clicked-layer")||e.addSource("clicked-layer",{type:"geojson",data:a}),e.getLayer("clicked-layer")||e.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#f9f91d","fill-outline-color":"#f9f91d","fill-opacity":.5}},r))})}function w(){e.getLayer("clicked-layer")&&e.removeLayer("clicked-layer"),e.getSource("clicked-layer")&&e.removeSource("clicked-layer")}async function B(r,l,o){e.getLayer("clicked-layer")&&e.removeLayer("clicked-layer"),e.getSource("clicked-layer")&&e.removeSource("clicked-layer"),L(),M();const t=await(await fetch(`https://api.icgc.cat/territori/${o}/geo/${l}/${r}`)).json();m=t[0].features;const n=document.getElementById("infoPanelContent");n.innerHTML="";let c=[],s=null,u=null;if(t[0].features.length<4)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let i=0;i<t[0].features.length;i++)c.push(t[0].features[i].id),t[0].features[i].id==="Geocodificador"?s=t[0].features[i].properties:t[0].features[i].id==="Elevació"&&(u=t[0].features[i].properties.value);s&&(n.innerHTML+=`<b>Adreça: </b> ${s.etiqueta} <br>`),u&&(n.innerHTML+=`<b>Coordenades: </b> ${r.toFixed(4)}, ${l.toFixed(4)} <br>`,n.innerHTML+=`<b>Elevació: </b> ${u} metres<br><br>`);for(let i=0;i<c.length;i++)if(c[i]!=="Geocodificador"&&c[i]!=="Elevació"&&c[i]!=="H3 geospatial indexing system"){const p=c[i],f=document.createElement("button");f.textContent=p,f.classList.add("myButtonClass"),f.addEventListener("click",()=>{P(p,f)}),n.appendChild(f),n.appendChild(document.createElement("br"))}}_()}function P(r,l){const o=b(e.getStyle().layers);e.getLayer("clicked-layer")&&e.removeLayer("clicked-layer"),e.getSource("clicked-layer")&&e.removeSource("clicked-layer");const a=document.querySelector(".closeButtonClass");a&&a.parentNode.removeChild(a);let t=new maplibregl.LngLatBounds;for(let s=0;s<m.length;s++)if(r===m[s].id){e.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:m[s].geometry,properties:{}}}),e.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#f9f91d","fill-outline-color":"#f9f91d","fill-opacity":.5}},o);const u=m[s].geometry;u.type==="Polygon"?u.coordinates[0].forEach(d=>{t.extend(d)}):u.type==="MultiPolygon"&&u.coordinates.forEach(d=>{d[0].forEach(v=>{t.extend(v)})}),document.querySelectorAll(".layer-properties").forEach(d=>d.remove());const p=document.createElement("div");p.classList.add("layer-properties");const f=m[s].properties;for(const[d,v]of Object.entries(f)){const h=document.createElement("div");h.textContent=`${d}: ${v}`,p.appendChild(h)}const y=document.createElement("button");y.textContent="×",y.classList.add("closeButtonClass"),y.addEventListener("click",()=>{w(),p.remove(),y.remove()}),p.appendChild(y),l.parentNode.insertBefore(p,l.nextSibling),l.parentNode.insertBefore(y,l.nextSibling),document.querySelectorAll(".myButtonClass").forEach(d=>d.classList.remove("highlighted-button")),l.classList.add("highlighted-button")}const c=window.innerWidth<750?E:S;e.fitBounds(t,{padding:c})}function b(r){let l="background";for(var o=0;o<r.length;o++)if(r[o].type=="symbol"&&r[o]["source-layer"]!=="contour")return l=r[o].id,l}async function x(r){const o=await(await fetch(`https://api.icgc.cat/territori/adress/${r}`)).json();console.log("dades",o),o.features?(e.getLayer("punts2")?(e.removeLayer("punts2").removeSource("punts2"),e.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:o.features}}),e.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})):(e.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:o.features}}),e.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})),e.flyTo({center:[o.features[0].geometry.coordinates[0],o.features[0].geometry.coordinates[1]],zoom:11,essential:!0})):alert(o);const a=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});e.getLayer("punts2")&&(e.on("mouseenter","punts2",function(t){e.getCanvas().style.cursor="pointer",a.setLngLat(t.features[0].geometry.coordinates).setHTML(`Adreça: <b>${t.features[0].properties.etiqueta}</b><br>
      Carrer: <b>${t.features[0].properties.nom}</b><br>
      Municipi: <b>${t.features[0].properties.municipi}</b><br>
      Codi Postal: <b>${t.features[0].properties.codi_postal}</b><br>`).addTo(e)}),e.on("mouseleave","punts2",function(t){e.getCanvas().style.cursor="",a.remove()}))}function I(){e=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",center:[2.0042,41.7747],zoom:7,attributionControl:!1,hash:!1}),e.addControl(new maplibregl.NavigationControl,"top-right");var r=new maplibregl.FullscreenControl;e.addControl(r,"top-right"),e.on("click",function(l){let o=l.lngLat.lng,a=l.lngLat.lat;B(a,o,C),g?(g.remove(),g=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([o,a]).addTo(e)):g=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([o,a]).addTo(e)})}function M(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function _(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}function L(){var r=document.getElementById("infoPanel");r.classList.add("open"),r.style.width="300px",document.getElementById("openPanel").style.display="none"}function $(){var r=document.getElementById("infoPanel");r.classList.remove("open"),r.style.width="0px",document.getElementById("openPanel").style.display="block"}function j(){I();const r=document.getElementById("textSelector");r.addEventListener("change",()=>{const l=r.value;x(l)})}window.addEventListener("DOMContentLoaded",j);window.closePanel=$;window.openPanel=L;window.onBaseChange=k;
