(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();var e,f;let b="all",u;const v=5,L=150;async function E(){const n=document.getElementById("serveiSelector2").value;let r=null;if(e.getLayer("clicked-layer")){const t=e.getSource("clicked-layer");t&&t._data&&(r=t._data)}let i;n==="orto"?i="https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json":n==="topo"?i="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json":n==="fosc"&&(i="https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json"),e.setStyle(i),e.once("styledata",()=>{r&&(e.getSource("clicked-layer")||e.addSource("clicked-layer",{type:"geojson",data:r}),e.getLayer("clicked-layer")||e.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#fee899","fill-opacity":.7}},"water-name-lakeline-z12"))})}async function C(a,n,r){e.getLayer("clicked-layer")&&e.removeLayer("clicked-layer"),e.getSource("clicked-layer")&&e.removeSource("clicked-layer"),h(),B();const t=await(await fetch(`https://api.icgc.cat/territori/${r}/geo/${n}/${a}`)).json();u=t[0].features;const o=document.getElementById("infoPanelContent");o.innerHTML="";let l=[],p=null,d=null;if(t[0].features.length<4)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let s=0;s<t[0].features.length;s++)l.push(t[0].features[s].id),t[0].features[s].id==="Geocodificador"?p=t[0].features[s].properties:t[0].features[s].id==="Elevació"&&(d=t[0].features[s].value);p&&(o.innerHTML+=`<b>Adreça: </b> ${p.etiqueta} <br>`),d&&(o.innerHTML+=`<b>Coordenades: </b> ${a.toFixed(4)}, ${n.toFixed(4)} <br>`,o.innerHTML+=`<b>Elevació: </b> ${d} metres<br><br>`);for(let s=0;s<l.length;s++)if(l[s]!=="Geocodificador"&&l[s]!=="Elevació"&&l[s]!=="H3 geospatial indexing system"){const y=l[s],c=document.createElement("button");c.textContent=y,c.classList.add("myButtonClass"),c.addEventListener("click",()=>{w(y,c)}),o.appendChild(c),o.appendChild(document.createElement("br"))}}S()}function w(a,n){e.getLayer("clicked-layer")&&e.removeLayer("clicked-layer"),e.getSource("clicked-layer")&&e.removeSource("clicked-layer");let r=new maplibregl.LngLatBounds;for(let o=0;o<u.length;o++)if(a===u[o].id){e.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:u[o].geometry,properties:{}}}),e.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#fee899","fill-opacity":.7}},"water-name-lakeline-z12");const l=u[o].geometry;l.type==="Polygon"?l.coordinates[0].forEach(c=>{r.extend(c)}):l.type==="MultiPolygon"&&l.coordinates.forEach(c=>{c[0].forEach(g=>{r.extend(g)})}),document.querySelectorAll(".layer-properties").forEach(c=>c.remove());const d=document.createElement("div");d.classList.add("layer-properties");const s=u[o].properties;for(const[c,g]of Object.entries(s)){const m=document.createElement("div");m.textContent=`${c}: ${g}`,d.appendChild(m)}n.parentNode.insertBefore(d,n.nextSibling),document.querySelectorAll(".myButtonClass").forEach(c=>c.classList.remove("highlighted-button")),n.classList.add("highlighted-button")}const t=window.innerWidth<750?v:L;e.fitBounds(r,{padding:t})}async function k(a){const r=await(await fetch(`https://api.icgc.cat/territori/adress/${a}`)).json();r.features?(e.getLayer("punts2")?(e.removeLayer("punts2").removeSource("punts2"),e.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:r.features}}),e.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})):(e.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:r.features}}),e.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})),e.flyTo({center:[r.features[0].geometry.coordinates[0],r.features[0].geometry.coordinates[1]],zoom:11,essential:!0})):alert(r);const i=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});e.getLayer("punts2")&&(e.on("mouseenter","punts2",function(t){e.getCanvas().style.cursor="pointer",i.setLngLat(t.features[0].geometry.coordinates).setHTML(`Adreça: <b>${t.features[0].properties.etiqueta}</b><br>
      Carrer: <b>${t.features[0].properties.street}</b><br>
      Municipi: <b>${t.features[0].properties.mun}</b><br>
      Codi Postal: <b>${t.features[0].properties.postalcode}</b><br>`).addTo(e)}),e.on("mouseleave","punts2",function(t){e.getCanvas().style.cursor="",i.remove()}))}function P(){e=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",center:[2.0042,41.7747],zoom:7,attributionControl:!1,hash:!1}),e.addControl(new maplibregl.NavigationControl,"top-right");var a=new maplibregl.FullscreenControl;e.addControl(a,"top-right"),e.on("click",function(n){let r=n.lngLat.lng,i=n.lngLat.lat;C(i,r,b),f?(f.remove(),f=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([r,i]).addTo(e)):f=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([r,i]).addTo(e)})}function B(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function S(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}function h(){var a=document.getElementById("infoPanel");a.classList.add("open"),a.style.width="300px",document.getElementById("openPanel").style.display="none"}function x(){var a=document.getElementById("infoPanel");a.classList.remove("open"),a.style.width="0px",document.getElementById("openPanel").style.display="block"}function I(){P();const a=document.getElementById("textSelector");a.addEventListener("change",()=>{const n=a.value;k(n)})}window.addEventListener("DOMContentLoaded",I);window.closePanel=x;window.openPanel=h;window.onBaseChange=E;
