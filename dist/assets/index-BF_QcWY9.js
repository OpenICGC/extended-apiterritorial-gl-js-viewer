(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();var t,f;let b="all",y="fosc",u;const L=5,E=150;async function P(){y=document.getElementById("serveiSelector2").value,y==="orto"?t.setStyle("https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json"):y==="topo"?t.setStyle("https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json"):y==="fosc"&&t.setStyle("https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json")}async function B(r,a,n){t.getLayer("clicked-layer")&&t.removeLayer("clicked-layer"),t.getSource("clicked-layer")&&t.removeSource("clicked-layer"),h(),k();const e=await(await fetch(`https://api.icgc.cat/territori/${n}/geo/${a}/${r}`)).json();u=e[0].features;const o=document.getElementById("infoPanelContent");o.innerHTML="";let i=[],p=null,d=null;if(e[0].features.length<4)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let s=0;s<e[0].features.length;s++)i.push(e[0].features[s].id),e[0].features[s].id==="Geocodificador"?p=e[0].features[s].properties:e[0].features[s].id==="Elevació"&&(d=e[0].features[s].value);p&&(o.innerHTML+=`<b>Adreça: </b> ${p.etiqueta} <br>`),d&&(o.innerHTML+=`<b>Coordenades: </b> ${r.toFixed(4)}, ${a.toFixed(4)} <br>`,o.innerHTML+=`<b>Elevació: </b> ${d} metres<br><br>`);for(let s=0;s<i.length;s++)if(i[s]!=="Geocodificador"&&i[s]!=="Elevació"&&i[s]!=="H3 geospatial indexing system"){const m=i[s],c=document.createElement("button");c.textContent=m,c.classList.add("myButtonClass"),c.addEventListener("click",()=>{C(m,c)}),o.appendChild(c),o.appendChild(document.createElement("br"))}}x()}function C(r,a){t.getLayer("clicked-layer")&&t.removeLayer("clicked-layer"),t.getSource("clicked-layer")&&t.removeSource("clicked-layer");let n=new maplibregl.LngLatBounds;for(let o=0;o<u.length;o++)if(r===u[o].id){t.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:u[o].geometry,properties:{}}}),t.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#fee899","fill-opacity":.7}},"water-name-lakeline-z12");const i=u[o].geometry;i.type==="Polygon"?i.coordinates[0].forEach(c=>{n.extend(c)}):i.type==="MultiPolygon"&&i.coordinates.forEach(c=>{c[0].forEach(g=>{n.extend(g)})}),document.querySelectorAll(".layer-properties").forEach(c=>c.remove());const d=document.createElement("div");d.classList.add("layer-properties");const s=u[o].properties;for(const[c,g]of Object.entries(s)){const v=document.createElement("div");v.textContent=`${c}: ${g}`,d.appendChild(v)}a.parentNode.insertBefore(d,a.nextSibling),document.querySelectorAll(".myButtonClass").forEach(c=>c.classList.remove("highlighted-button")),a.classList.add("highlighted-button")}const e=window.innerWidth<750?L:E;t.fitBounds(n,{padding:e})}async function S(r){const n=await(await fetch(`https://api.icgc.cat/territori/adress/${r}`)).json();n.features?(t.getLayer("punts2")?(t.removeLayer("punts2").removeSource("punts2"),t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:n.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})):(t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:n.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})),t.flyTo({center:[n.features[0].geometry.coordinates[0],n.features[0].geometry.coordinates[1]],zoom:11,essential:!0})):alert(n);const l=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});t.getLayer("punts2")&&(t.on("mouseenter","punts2",function(e){t.getCanvas().style.cursor="pointer",l.setLngLat(e.features[0].geometry.coordinates).setHTML(`Adreça: <b>${e.features[0].properties.etiqueta}</b><br>
      Carrer: <b>${e.features[0].properties.street}</b><br>
      Municipi: <b>${e.features[0].properties.mun}</b><br>
      Codi Postal: <b>${e.features[0].properties.postalcode}</b><br>`).addTo(t)}),t.on("mouseleave","punts2",function(e){t.getCanvas().style.cursor="",l.remove()}))}function w(){t=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",center:[2.0042,41.7747],zoom:7,attributionControl:!1,hash:!1}),t.addControl(new maplibregl.NavigationControl,"top-right");var r=new maplibregl.FullscreenControl;t.addControl(r,"top-right"),t.on("click",function(a){let n=a.lngLat.lng,l=a.lngLat.lat;B(l,n,b),f?(f.remove(),f=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([n,l]).addTo(t)):f=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([n,l]).addTo(t)})}function k(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function x(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}function h(){var r=document.getElementById("infoPanel");r.classList.add("open"),r.style.width="300px",document.getElementById("openPanel").style.display="none"}function I(){var r=document.getElementById("infoPanel");r.classList.remove("open"),r.style.width="0px",document.getElementById("openPanel").style.display="block"}function M(){w(),document.getElementById("serveiSelector2").addEventListener("change",P),document.getElementById("openPanel").addEventListener("click",h),document.getElementById("closePanel").addEventListener("click",I);const l=document.getElementById("textSelector");l.addEventListener("change",()=>{const e=l.value;S(e)})}window.addEventListener("DOMContentLoaded",M);
