(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=a(e);fetch(e.href,o)}})();var r,y;let m="all",u;async function g(s,i,a){r.getLayer("clicked-layer")&&r.removeLayer("clicked-layer"),r.getSource("clicked-layer")&&r.removeSource("clicked-layer"),E(),v();const e=await(await fetch(`https://api.icgc.cat/territori/${a}/geo/${i}/${s}`)).json();u=e[0].features;const o=document.getElementById("infoPanelContent");o.innerHTML="";let l=[],f=null,p=null;if(e[0].features.length<4)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let t=0;t<e[0].features.length;t++)l.push(e[0].features[t].id),e[0].features[t].id==="Geocodificador"?f=e[0].features[t].properties:e[0].features[t].id==="Elevació"&&(p=e[0].features[t].value);f&&(o.innerHTML+=`<b>Adreça: </b> ${f.etiqueta} <br>`),p&&(o.innerHTML+=`<b>Elevació: </b> ${p} metres<br><br>`);for(let t=0;t<l.length;t++)if(l[t]!=="Geocodificador"&&l[t]!=="Elevació"&&l[t]!=="H3 geospatial indexing system"){const d=l[t],c=document.createElement("button");c.textContent=d,c.classList.add("myButtonClass"),c.addEventListener("click",()=>{h(d,c)}),o.appendChild(c),o.appendChild(document.createElement("br"))}}b()}function h(s,i){console.log("Afegim geometria per al servei:",s),r.getLayer("clicked-layer")&&r.removeLayer("clicked-layer"),r.getSource("clicked-layer")&&r.removeSource("clicked-layer");let a=new maplibregl.LngLatBounds;for(let n=0;n<u.length;n++)if(s===u[n].id){r.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:u[n].geometry,properties:{}}}),r.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#fee899","fill-opacity":.8}});const e=u[n].geometry;e.type==="Polygon"?e.coordinates[0].forEach(t=>{a.extend(t)}):e.type==="MultiPolygon"&&e.coordinates.forEach(t=>{t[0].forEach(d=>{a.extend(d)})}),document.querySelectorAll(".layer-properties").forEach(t=>t.remove());const l=document.createElement("div");l.classList.add("layer-properties");const f=u[n].properties;for(const[t,d]of Object.entries(f)){const c=document.createElement("div");c.textContent=`${t}: ${d}`,l.appendChild(c)}i.parentNode.insertBefore(l,i.nextSibling),document.querySelectorAll(".myButtonClass").forEach(t=>t.classList.remove("highlighted-button")),i.classList.add("highlighted-button")}r.fitBounds(a,{padding:200})}function L(){r=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",center:[2.0042,41.7747],zoom:7,attributionControl:!1,hash:!1}),r.addControl(new maplibregl.NavigationControl,"top-right");var s=new maplibregl.FullscreenControl;r.addControl(s,"top-right"),r.on("click",function(i){let a=i.lngLat.lng,n=i.lngLat.lat;g(n,a,m),y?(y.remove(),y=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([a,n]).addTo(r)):y=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([a,n]).addTo(r)})}function v(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function b(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}function E(){var s=document.getElementById("infoPanel");s.classList.add("open"),s.style.width="400px",document.getElementById("openPanel").style.display="none"}L();
