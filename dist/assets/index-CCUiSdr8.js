(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=r(e);fetch(e.href,s)}})();var t,y;let v="all",m="fosc",u;async function h(){m=document.getElementById("serveiSelector2").value,m==="orto"?t.setStyle("https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json"):m==="topo"?t.setStyle("https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json"):m==="fosc"&&t.setStyle("https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json")}async function L(a,i,r){t.getLayer("clicked-layer")&&t.removeLayer("clicked-layer"),t.getSource("clicked-layer")&&t.removeSource("clicked-layer"),g(),P();const e=await(await fetch(`https://api.icgc.cat/territori/${r}/geo/${i}/${a}`)).json();u=e[0].features;const s=document.getElementById("infoPanelContent");s.innerHTML="";let l=[],p=null,f=null;if(e[0].features.length<4)document.getElementById("infoPanelContent").innerHTML="No hi ha dades sobre el punt seleccionat.";else{for(let o=0;o<e[0].features.length;o++)l.push(e[0].features[o].id),e[0].features[o].id==="Geocodificador"?p=e[0].features[o].properties:e[0].features[o].id==="Elevació"&&(f=e[0].features[o].value);p&&(s.innerHTML+=`<b>Adreça: </b> ${p.etiqueta} <br>`),f&&(s.innerHTML+=`<b>Elevació: </b> ${f} metres<br><br>`);for(let o=0;o<l.length;o++)if(l[o]!=="Geocodificador"&&l[o]!=="Elevació"&&l[o]!=="H3 geospatial indexing system"){const d=l[o],c=document.createElement("button");c.textContent=d,c.classList.add("myButtonClass"),c.addEventListener("click",()=>{b(d,c)}),s.appendChild(c),s.appendChild(document.createElement("br"))}}C()}function b(a,i){console.log("Afegim geometria per al servei:",a),t.getLayer("clicked-layer")&&t.removeLayer("clicked-layer"),t.getSource("clicked-layer")&&t.removeSource("clicked-layer");let r=new maplibregl.LngLatBounds;for(let n=0;n<u.length;n++)if(a===u[n].id){t.addSource("clicked-layer",{type:"geojson",data:{type:"Feature",geometry:u[n].geometry,properties:{}}}),t.addLayer({id:"clicked-layer",type:"fill",source:"clicked-layer",layout:{},paint:{"fill-color":"#fee899","fill-opacity":.8}});const e=u[n].geometry;e.type==="Polygon"?e.coordinates[0].forEach(o=>{r.extend(o)}):e.type==="MultiPolygon"&&e.coordinates.forEach(o=>{o[0].forEach(d=>{r.extend(d)})}),document.querySelectorAll(".layer-properties").forEach(o=>o.remove());const l=document.createElement("div");l.classList.add("layer-properties");const p=u[n].properties;for(const[o,d]of Object.entries(p)){const c=document.createElement("div");c.textContent=`${o}: ${d}`,l.appendChild(c)}i.parentNode.insertBefore(l,i.nextSibling),document.querySelectorAll(".myButtonClass").forEach(o=>o.classList.remove("highlighted-button")),i.classList.add("highlighted-button")}setTimeout(function(){t.fitBounds(r,{padding:200})},0)}async function E(a){const r=await(await fetch(`https://api.icgc.cat/territori/adress/${a}`)).json();r.features?(t.getLayer("punts2")?(t.removeLayer("punts2").removeSource("punts2"),t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:r.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})):(t.addSource("punts2",{type:"geojson",data:{type:"FeatureCollection",features:r.features}}),t.addLayer({id:"punts2",type:"circle",source:"punts2",paint:{"circle-color":"red","circle-opacity":.8,"circle-radius":6}})),t.flyTo({center:[r.features[0].geometry.coordinates[0],r.features[0].geometry.coordinates[1]],zoom:11,essential:!0})):alert(r);const n=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});t.getLayer("punts2")&&(t.on("mouseenter","punts2",function(e){t.getCanvas().style.cursor="pointer",n.setLngLat(e.features[0].geometry.coordinates).setHTML(`Adreça: <b>${e.features[0].properties.etiqueta}</b><br>
      Carrer: <b>${e.features[0].properties.street}</b><br>
      Municipi: <b>${e.features[0].properties.mun}</b><br>
      Codi Postal: <b>${e.features[0].properties.postalcode}</b><br>`).addTo(t)}),t.on("mouseleave","punts2",function(e){t.getCanvas().style.cursor="",n.remove()}))}function B(){t=new maplibregl.Map({container:"map",style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",center:[2.0042,41.7747],zoom:7,attributionControl:!1,hash:!1}),t.addControl(new maplibregl.NavigationControl,"top-right");var a=new maplibregl.FullscreenControl;t.addControl(a,"top-right"),t.on("click",function(i){let r=i.lngLat.lng,n=i.lngLat.lat;L(n,r,v),y?(y.remove(),y=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([r,n]).addTo(t)):y=new maplibregl.Marker({color:"#FF6E42"}).setLngLat([r,n]).addTo(t)})}function P(){document.getElementById("loader").style.display="block",document.getElementById("infoPanelContent").style.display="none"}function C(){document.getElementById("loader").style.display="none",document.getElementById("infoPanelContent").style.display="block"}function g(){var a=document.getElementById("infoPanel");a.classList.add("open"),a.style.width="400px",document.getElementById("openPanel").style.display="none"}function S(){var a=document.getElementById("infoPanel");a.classList.remove("open"),a.style.width="0px",document.getElementById("openPanel").style.display="block"}function k(){B(),document.getElementById("serveiSelector2").addEventListener("change",h),document.getElementById("openPanel").addEventListener("click",g),document.getElementById("closePanel").addEventListener("click",S);const n=document.getElementById("textSelector");n.addEventListener("change",()=>{const e=n.value;E(e)})}window.addEventListener("DOMContentLoaded",k);
